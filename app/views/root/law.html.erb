<%- model_class_vs = VotingSession -%>
<%- model_class_ad = AllDelegate -%>
<%- model_class_vr = VotingResult -%>

<% title t('.title', :name => @agenda.official_law_title.present? ? @agenda.official_law_title : @agenda.name, :date => l(@agenda.conference.start_date, :format => :no_zone)).html_safe %>

<div id="agenda_description">
  <ul>
    <li>
      <strong><%= Conference.human_attribute_name(:start_date_final) %>:</strong>
      <%= l(@agenda.conference.start_date, :format => :no_zone) %>
    </li>
    <li>
      <strong><%= Agenda.human_attribute_name(:parliament_id) %>:</strong>
      <%= @agenda.parliament.name %>
    </li>
    <li>
      <strong><%= Agenda.human_attribute_name(:official_law_title) %>:</strong>
      <%= @agenda.official_law_title %>
    </li>
    <li>
      <strong><%= Agenda.human_attribute_name(:law_description) %>:</strong>
      <%= @agenda.law_description %>
    </li>
    <li>
      <strong><%= Agenda.human_attribute_name(:law_id) %>:</strong>
      <%= @agenda.law_id %>
    </li>    
    <li>
      <strong><%= Agenda.human_attribute_name(:law_url) %>:</strong>
      <% if @agenda.law_url.present? %>
        <%= link_to( 
          t('helpers.links.view_law_url'), 
          @agenda.law_url, :class => 'btn btn-mini', :target => :blank) %>
      <% end %>
    </li>    
  </ul>
  
</div>

<% if @agenda.voting_session.present? && @agenda.voting_session.voting_results.present? %>
  <div id="agenda_counts" class="clear">
    <table class="display table table-striped table-bordered span8">
      <thead>
        <tr>
          <th><%= model_class_vs.model_name.human %></th>
          <th><%= t('helpers.boolean.y') %></th>
          <th><%= t('helpers.boolean.n') %></th>
          <th><%= t('helpers.boolean.abstain') %></th>
          <th><%= t('helpers.links.not_present') %></th>
        </tr>
      </thead>
      <tbody>
        <% if @agenda.prior_to_all_session_data? || @agenda.is_by_one_session? %>
          <tr>
            <td>
              <%= t('.by_one_session_summary_header') %>
            </td>
            <td>
              <%= @agenda.total_yes %>
            </td>
            <td>
              <%= @agenda.total_no %>
            </td>
            <td>
              <%= @agenda.total_abstain %>
            </td>
            <td>
              <%= @agenda.total_not_present %>
            </td>
          </tr>
        <% else %>
          <tr>
            <td>
              <%= t('.session3_summary_header') %>
            </td>
            <td>
              <%= @agenda.total_yes %>
            </td>
            <td>
              <%= @agenda.total_no %>
            </td>
            <td>
              <%= @agenda.total_abstain %>
            </td>
            <td>
              <%= @agenda.total_not_present %>
            </td>
          </tr>
          <% if @agenda.session_number2_id.present? %>
            <tr>
              <td>
                <%= t('.session2_summary_header') %>
              </td>
              <td>
                <%= @agenda.session_number2.total_yes %>
              </td>
              <td>
                <%= @agenda.session_number2.total_no %>
              </td>
              <td>
                <%= @agenda.session_number2.total_abstain %>
              </td>
              <td>
                <%= @agenda.session_number2.total_not_present %>
              </td>
            </tr>
          <% end %>
          <% if @agenda.session_number1_id.present? %>
            <tr>
              <td>
                <%= t('.session1_summary_header') %>
              </td>
              <td>
                <%= @agenda.session_number1.total_yes %>
              </td>
              <td>
                <%= @agenda.session_number1.total_no %>
              </td>
              <td>
                <%= @agenda.session_number1.total_abstain %>
              </td>
              <td>
                <%= @agenda.session_number1.total_not_present %>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
 </div>

  <% if @agenda.prior_to_all_session_data? || @agenda.is_by_one_session? %>
    <table id="voting_results_public_datatable" class="display table table-striped table-bordered" 
          data-source="<%= search_voting_results_url(:agenda_id => @agenda.id, :get_all_3_sessions => false, :format => :json) %>">
      <thead>
        <tr>
          <th><%= model_class_ad.human_attribute_name(:first_name) %></th>
          <th><%= model_class_vr.human_attribute_name(:present) %></th>
          <th><%= model_class_vr.human_attribute_name(:vote) %></th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>

  <% else %>
    <table id="voting_results_public_datatable" class="display table table-striped table-bordered" 
          data-source="<%= search_voting_results_url(:agenda_id => @agenda.id, :format => :json) %>">
      <thead>
        <tr>
          <th><%= model_class_ad.human_attribute_name(:first_name) %></th>
          <th><%= model_class_ad.human_attribute_name(:session3_present) %></th>
          <th><%= model_class_ad.human_attribute_name(:session3_vote) %></th>
          <th><%= model_class_ad.human_attribute_name(:session2_present) %></th>
          <th><%= model_class_ad.human_attribute_name(:session2_vote) %></th>
          <th><%= model_class_ad.human_attribute_name(:session1_present) %></th>
          <th><%= model_class_ad.human_attribute_name(:session1_vote) %></th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  <% end %>
<% else %>
  <p>
    <%= t('.no_results') %>
  </p>
<% end %>
